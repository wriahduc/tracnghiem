import { useState } from "react";
import { motion } from "framer-motion";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";

const TELEGRAM_BOT_TOKEN = "7850658680:AAGaA_pA4cZfpVJXCVORKOa-gmbEJtm8Bjo";
const TELEGRAM_CHAT_ID = "6388563306";

const slides = [
  { title: "Ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t l√† g√¨?", content: "Ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t l√† ph∆∞∆°ng tr√¨nh c√≥ d·∫°ng ax + b = 0, v·ªõi a v√† b l√† c√°c s·ªë th·ª±c v√† a ‚â† 0." },
  { title: "D·∫°ng t·ªïng qu√°t c·ªßa ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t", content: "Ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t c√≥ d·∫°ng t·ªïng qu√°t l√† ax + b = 0. V√≠ d·ª•: 2x - 3 = 0." },
  { title: "C√°ch gi·∫£i ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t", content: "ƒê·ªÉ gi·∫£i ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t ax + b = 0, ta th·ª±c hi·ªán c√°c b∆∞·ªõc sau: \n1. Chuy·ªÉn b v·ªÅ v·∫ø ph·∫£i: ax = -b \n2. Chia c·∫£ hai v·∫ø cho a: x = -b/a." },
  { title: "·ª®ng d·ª•ng c·ªßa ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t", content: "Ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t ƒë∆∞·ª£c ·ª©ng d·ª•ng trong nhi·ªÅu lƒ©nh v·ª±c nh∆∞ to√°n h·ªçc, v·∫≠t l√Ω, kinh t·∫ø ƒë·ªÉ gi·∫£i quy·∫øt c√°c b√†i to√°n th·ª±c t·∫ø." },
  { title: "B√†i t·∫≠p m·∫´u", content: "H√£y gi·∫£i ph∆∞∆°ng tr√¨nh: 3x - 6 = 0. H∆∞·ªõng d·∫´n: Chuy·ªÉn -6 sang v·∫ø ph·∫£i v√† chia c·∫£ hai v·∫ø cho 3 ƒë·ªÉ t√¨m x." }
];

const questions = [
  { question: "Ph∆∞∆°ng tr√¨nh n√†o l√† b·∫≠c nh·∫•t?", options: ["x^2 + 2x = 3", "2x + 1 = 0", "x^3 - x = 4"], answer: 1 },
  { question: "Nghi·ªám c·ªßa 2x - 4 = 0 l√†?", options: ["x = 2", "x = -2", "x = 4"], answer: 0 },
  { question: "Gi√° tr·ªã c·ªßa x trong ph∆∞∆°ng tr√¨nh 5x + 10 = 0?", options: ["x = -2", "x = 2", "x = -5"], answer: 0 },
  { question: "Ph∆∞∆°ng tr√¨nh n√†o kh√¥ng ph·∫£i l√† b·∫≠c nh·∫•t?", options: ["4x - 7 = 0", "x^2 - 3x + 2 = 0", "3x + 1 = 0"], answer: 1 },
  { question: "T√¨m x trong 3x - 9 = 0", options: ["x = 3", "x = -3", "x = 9"], answer: 0 },
  { question: "Ph∆∞∆°ng tr√¨nh x + 5 = 0 c√≥ nghi·ªám l√†?", options: ["x = -5", "x = 5", "x = 0"], answer: 0 },
  { question: "N·∫øu 2x = 10 th√¨ x = ?", options: ["x = 2", "x = 5", "x = 10"], answer: 1 },
  { question: "Gi√° tr·ªã c·ªßa x khi gi·∫£i ph∆∞∆°ng tr√¨nh x - 7 = 3?", options: ["x = 4", "x = 7", "x = 10"], answer: 2 },
  { question: "T√¨m x trong 6x + 18 = 0", options: ["x = -3", "x = 3", "x = -6"], answer: 0 },
  { question: "Ph∆∞∆°ng tr√¨nh n√†o c√≥ nghi·ªám x = 4?", options: ["x - 4 = 0", "2x + 3 = 0", "x^2 - 16 = 0"], answer: 0 }
];

function sendTelegramMessage(name, score) {
  const message = `üì¢ K·∫øt qu·∫£ ki·ªÉm tra\nüë§ H·ªç t√™n: ${name}\nüéØ ƒêi·ªÉm s·ªë: ${score} / ${questions.length}`;
  fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message })
  });
}

function Quiz() {
  const [score, setScore] = useState(0);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [selectedOption, setSelectedOption] = useState(null);
  const [completed, setCompleted] = useState(false);
  const [name, setName] = useState("");

  const handleAnswer = () => {
    if (selectedOption === questions[currentQuestion].answer) {
      setScore(score + 1);
    }
    if (currentQuestion + 1 < questions.length) {
      setCurrentQuestion(currentQuestion + 1);
      setSelectedOption(null);
    } else {
      setCompleted(true);
      sendTelegramMessage(name, score + 1);
    }
  };

  return (
    <div className="w-full max-w-2xl p-6 bg-white shadow-lg rounded-2xl text-center">
      {!completed ? (
        <>
          <input
            type="text"
            placeholder="Nh·∫≠p h·ªç t√™n"
            value={name}
            onChange={(e) => setName(e.target.value)}
            className="mb-4 p-2 border rounded w-full"
          />
          <h2 className="text-xl font-semibold mb-4">{questions[currentQuestion].question}</h2>
          {questions[currentQuestion].options.map((option, index) => (
            <div key={index} className="mb-2">
              <Button
                className={`w-full ${selectedOption === index ? 'bg-blue-500' : ''}`}
                onClick={() => setSelectedOption(index)}
              >
                {option}
              </Button>
            </div>
          ))}
          <Button className="mt-4" onClick={handleAnswer} disabled={selectedOption === null}>
            Ki·ªÉm tra ƒë√°p √°n
          </Button>
        </>
      ) : (
        <h2 className="text-xl font-bold">B·∫°n ƒë√£ ho√†n th√†nh! ƒêi·ªÉm s·ªë: {score} / {questions.length}</h2>
      )}
    </div>
  );
}

export default function QuizApp() {
  const [step, setStep] = useState(0);
  return (
    <div className="flex flex-col items-center justify-center min-h-screen p-5">
      {step < slides.length ? (
        <motion.div
          key={step}
          initial={{ opacity: 0, x: 50 }}
          animate={{ opacity: 1, x: 0 }}
          exit={{ opacity: 0, x: -50 }}
          className="w-full max-w-2xl p-6 bg-white shadow-lg rounded-2xl"
        >
          <h2 className="text-xl font-semibold text-center mb-4">{slides[step].title}</h2>
          <p className="text-center mb-4">{slides[step].content}</p>
          <div className="flex justify-between">
            {step > 0 && <Button onClick={() => setStep(step - 1)}>Quay l·∫°i</Button>}
            {step < slides.length - 1 ? <Button onClick={() => setStep(step + 1)}>Ti·∫øp t·ª•c</Button> : <Button onClick={() => setStep(step + 1)}>L√†m b√†i ki·ªÉm tra</Button>}
          </div>
        </motion.div>
      ) : (
        <Quiz />
      )}
    </div>
  );
}
